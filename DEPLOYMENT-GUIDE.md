# Dify部署指南

根据官方文档和实际使用需求，Dify可以采用两种部署方式：精简部署和完整部署。本指南将帮助您了解两种部署方式的区别，并选择最适合您的方案。

## 精简部署（当前使用）

精简部署只包含Dify的核心组件，适合个人使用或小规模测试。当前我们使用的就是精简部署方式。

### 包含组件

```
- api        核心API服务
- web        前端界面
- sandbox    插件执行器
- db         PostgreSQL数据库
- redis      缓存系统
```

### 优势

- 资源占用少，适合个人电脑或小型服务器
- 部署简单，配置较少
- 满足基本使用需求，包括模型调用、应用创建等
- 现在已支持插件功能

### 限制

- 缺少工作队列，可能在处理大量任务时不够稳定
- 没有专门的Web服务器进行负载均衡
- 缺少高级向量数据库功能
- 安全性相对较低

## 完整部署（可选升级）

完整部署包含Dify的所有组件，适合生产环境或需要更高稳定性、安全性的场景。

### 包含组件

```
- api        核心API服务
- worker     后台任务处理服务
- web        前端界面
- sandbox    插件执行器
- weaviate   向量数据库（替代ChromaDB）
- db         PostgreSQL数据库
- redis      缓存系统
- nginx      Web服务器和负载均衡
- ssrf_proxy 安全代理
```

### 优势

- 更好的任务处理能力，通过worker组件处理异步任务
- 增强的安全性，通过ssrf_proxy防止服务器端请求伪造攻击
- 专业的Web服务器配置，支持SSL、负载均衡等
- 高性能向量数据库，适合大规模知识库应用
- 更适合多用户同时使用的场景

### 配置要求

- 更多的系统资源（建议至少8GB RAM）
- 额外的配置文件：nginx.conf、squid.conf
- 更复杂的网络设置

## 如何选择部署方式

### 选择精简部署，如果您：

- 只是个人使用或小型团队
- 系统资源有限
- 主要用于测试和学习
- 不需要高并发处理能力
- 使用本地模型，主要关注模型调用功能

### 选择完整部署，如果您：

- 计划在生产环境中使用
- 有足够的系统资源
- 需要处理大量并发请求
- 需要构建大型知识库应用
- 对安全性有更高要求
- 计划长期运行服务

## 如何从精简部署升级到完整部署

1. 备份数据（数据库和存储文件）
2. 创建必要的配置文件（nginx.conf、squid.conf）
3. 修改docker-compose.yml为docker-compose-full.yml中的配置
4. 启动完整部署：`docker-compose down && docker-compose up -d`

## 注意事项

1. 无论采用哪种部署方式，都需要确保Ollama服务正常运行，以便使用本地模型
2. 请定期备份数据库和存储文件
3. 修改默认密码和密钥，提高安全性
4. 生产环境建议启用HTTPS 